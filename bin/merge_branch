#!/usr/bin/env bash
set -euo pipefail

if [ $# -lt 2 ]; then
    echo "Usage: $0 <branch> <commit_message>"
    exit 1
fi

branch="$1"
commit_message="$2"

if ! git rev-parse --verify "$branch" >/dev/null 2>&1; then
    echo "Error: Branch '$branch' does not exist"
    exit 1
fi

git merge --squash "$branch"
git commit -m "$commit_message"
git push
worktree_delete "$branch"
git branch -D "$branch"
